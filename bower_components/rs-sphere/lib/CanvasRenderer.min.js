/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null},THREE.Projector=function(){function e(){if(l===v){var e=new THREE.RenderableObject
    return T.push(e),v++,l++,e}return T[l++]}function t(){if(p===g){var e=new THREE.RenderableVertex
    return H.push(e),g++,p++,e}return H[p++]}function i(){if(f===w){var e=new THREE.RenderableFace
    return S.push(e),w++,f++,e}return S[f++]}function n(){if(m===b){var e=new THREE.RenderableLine
    return M.push(e),b++,m++,e}return M[m++]}function o(){if(d===z){var e=new THREE.RenderableSprite
    return C.push(e),z++,d++,e}return C[d++]}function r(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function a(e,t){var i=0,n=1,o=e.z+e.w,r=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w
    return 0>o||0>r||0>a||0>s?0>o&&0>r||0>a&&0>s?!1:(0>o?i=Math.max(i,o/(o-r)):0>r&&(n=Math.min(n,o/(o-r))),0>a?i=Math.max(i,a/(a-s)):0>s&&(n=Math.min(n,a/(a-s))),i>n?!1:(e.lerp(t,i),t.lerp(e,1-n),!0)):!0}var s,l,c,p,E,f,h,m,u,d,x,R,y,T=[],v=0,H=[],g=0,S=[],w=0,M=[],b=0,C=[],z=0,V={objects:[],lights:[],elements:[]},j=new THREE.Vector3,L=new THREE.Vector4,B=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),P=new THREE.Box3,W=Array(3),N=(Array(4),new THREE.Matrix4),k=new THREE.Matrix4,F=new THREE.Matrix4,D=new THREE.Matrix3,O=new THREE.Frustum,I=new THREE.Vector4,G=new THREE.Vector4
    this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")},R=function(){var e=[],o=[],r=null,a=null,s=new THREE.Matrix3,l=function(t){r=t,a=r.material,s.getNormalMatrix(r.matrixWorld),e.length=0,o.length=0},p=function(e){var t,i=e.position,n=e.positionWorld,o=e.positionScreen
        n.copy(i).applyMatrix4(x),o.copy(n).applyMatrix4(k),t=1/o.w,o.x*=t,o.y*=t,o.z*=t,e.visible=!(o.x<-1||o.x>1||o.y<-1||o.y>1||o.z<-1||o.z>1)},f=function(e,i,n){c=t(),c.position.set(e,i,n),p(c)},m=function(t,i,n){e.push(t,i,n)},u=function(e,t){o.push(e,t)},d=function(e,t,i){return e.visible===!0||t.visible===!0||i.visible===!0?!0:(W[0]=e.positionScreen,W[1]=t.positionScreen,W[2]=i.positionScreen,B.isIntersectionBox(P.setFromPoints(W)))},R=function(e,t,i){return(i.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(i.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0},y=function(e,t){var i=H[e],o=H[t]
        h=n(),h.id=r.id,h.v1.copy(i),h.v2.copy(o),h.z=(i.positionScreen.z+o.positionScreen.z)/2,h.material=r.material,V.elements.push(h)},T=function(t,n,l){var c,p,f,h,m,u=H[t],x=H[n],y=H[l]
        if(d(u,x,y)!==!1&&(a.side===THREE.DoubleSide||R(u,x,y)===!0)){for(E=i(),E.id=r.id,E.v1.copy(u),E.v2.copy(x),E.v3.copy(y),E.z=(u.positionScreen.z+x.positionScreen.z+y.positionScreen.z)/3,c=0;3>c;c++)p=3*arguments[c],f=E.vertexNormalsModel[c],f.set(e[p],e[p+1],e[p+2]),f.applyMatrix3(s).normalize(),h=2*arguments[c],m=E.uvs[c],m.set(o[h],o[h+1])
            E.vertexNormalsLength=3,E.material=r.material,V.elements.push(E)}}
        return{setObject:l,projectVertex:p,checkTriangleVisibility:d,checkBackfaceCulling:R,pushVertex:f,pushNormal:m,pushUv:u,pushLine:y,pushTriangle:T}},y=new R,this.projectScene=function(c,R,T,v){var g,S,w,M,b,C,z,B,P,W,A,U,q,J,K,Q,X,Y,Z,$,_,ee,te,ie,ne,oe,re,ae,se,le,ce,pe,Ee,fe,he,me,ue,de,xe,Re,ye,Te,ve,He,ge,Se
        for(f=0,m=0,d=0,V.elements.length=0,c.autoUpdate===!0&&c.updateMatrixWorld(),void 0===R.parent&&R.updateMatrixWorld(),N.copy(R.matrixWorldInverse.getInverse(R.matrixWorld)),k.multiplyMatrices(R.projectionMatrix,N),O.setFromMatrix(k),l=0,V.objects.length=0,V.lights.length=0,c.traverseVisible(function(t){if(t instanceof THREE.Light)V.lights.push(t)
        else if(t instanceof THREE.Mesh||t instanceof THREE.Line||t instanceof THREE.Sprite){if(t.material.visible===!1)return;(t.frustumCulled===!1||O.intersectsObject(t)===!0)&&(s=e(),s.id=t.id,s.object=t,j.setFromMatrixPosition(t.matrixWorld),j.applyProjection(k),s.z=j.z,V.objects.push(s))}}),T===!0&&V.objects.sort(r),g=0,S=V.objects.length;S>g;g++)if(w=V.objects[g].object,M=w.geometry,y.setObject(w),x=w.matrixWorld,p=0,w instanceof THREE.Mesh){if(M instanceof THREE.BufferGeometry){if(b=M.attributes,C=M.offsets,void 0===b.position)continue
            for(z=b.position.array,B=0,P=z.length;P>B;B+=3)y.pushVertex(z[B],z[B+1],z[B+2])
            if(void 0!==b.normal)for(W=b.normal.array,B=0,P=W.length;P>B;B+=3)y.pushNormal(W[B],W[B+1],W[B+2])
            if(void 0!==b.uv)for(A=b.uv.array,B=0,P=A.length;P>B;B+=2)y.pushUv(A[B],A[B+1])
            if(void 0!==b.index)if(U=b.index.array,C.length>0)for(g=0;g<C.length;g++)for(q=C[g],J=q.index,B=q.start,P=q.start+q.count;P>B;B+=3)y.pushTriangle(U[B]+J,U[B+1]+J,U[B+2]+J)
            else for(B=0,P=U.length;P>B;B+=3)y.pushTriangle(U[B],U[B+1],U[B+2])
            else for(B=0,P=z.length/3;P>B;B+=3)y.pushTriangle(B,B+1,B+2)}else if(M instanceof THREE.Geometry){for(K=M.vertices,Q=M.faces,X=M.faceVertexUvs[0],D.getNormalMatrix(x),Y=w.material,Z=Y instanceof THREE.MeshFaceMaterial,$=Z===!0?w.material:null,_=0,ee=K.length;ee>_;_++){if(te=K[_],j.copy(te),Y.morphTargets===!0)for(ie=M.morphTargets,ne=w.morphTargetInfluences,oe=0,re=ie.length;re>oe;oe++)ae=ne[oe],0!==ae&&(se=ie[oe],le=se.vertices[_],j.x+=(le.x-te.x)*ae,j.y+=(le.y-te.y)*ae,j.z+=(le.z-te.z)*ae)
            y.pushVertex(j.x,j.y,j.z)}for(ce=0,pe=Q.length;pe>ce;ce++)if(Ee=Q[ce],Y=Z===!0?$.materials[Ee.materialIndex]:w.material,void 0!==Y&&(fe=Y.side,he=H[Ee.a],me=H[Ee.b],ue=H[Ee.c],y.checkTriangleVisibility(he,me,ue)!==!1)){if(de=y.checkBackfaceCulling(he,me,ue),fe!==THREE.DoubleSide){if(fe===THREE.FrontSide&&de===!1)continue
            if(fe===THREE.BackSide&&de===!0)continue}for(E=i(),E.id=w.id,E.v1.copy(he),E.v2.copy(me),E.v3.copy(ue),E.normalModel.copy(Ee.normal),de!==!1||fe!==THREE.BackSide&&fe!==THREE.DoubleSide||E.normalModel.negate(),E.normalModel.applyMatrix3(D).normalize(),xe=Ee.vertexNormals,Re=0,ye=Math.min(xe.length,3);ye>Re;Re++)Te=E.vertexNormalsModel[Re],Te.copy(xe[Re]),de!==!1||fe!==THREE.BackSide&&fe!==THREE.DoubleSide||Te.negate(),Te.applyMatrix3(D).normalize()
            if(E.vertexNormalsLength=xe.length,ve=X[ce],void 0!==ve)for(He=0;3>He;He++)E.uvs[He].copy(ve[He])
            E.color=Ee.color,E.material=Y,E.z=(he.positionScreen.z+me.positionScreen.z+ue.positionScreen.z)/3,V.elements.push(E)}}}else if(w instanceof THREE.Line){if(M instanceof THREE.BufferGeometry){if(b=M.attributes,void 0!==b.position){for(z=b.position.array,B=0,P=z.length;P>B;B+=3)y.pushVertex(z[B],z[B+1],z[B+2])
            if(void 0!==b.index)for(U=b.index.array,B=0,P=U.length;P>B;B+=2)y.pushLine(U[B],U[B+1])
            else for(ge=w.mode===THREE.LinePieces?2:1,B=0,P=z.length/3-1;P>B;B+=ge)y.pushLine(B,B+1)}}else if(M instanceof THREE.Geometry){if(F.multiplyMatrices(k,x),K=w.geometry.vertices,0===K.length)continue
            for(he=t(),he.positionScreen.copy(K[0]).applyMatrix4(F),ge=w.mode===THREE.LinePieces?2:1,_=1,ee=K.length;ee>_;_++)he=t(),he.positionScreen.copy(K[_]).applyMatrix4(F),(_+1)%ge>0||(me=H[p-2],I.copy(he.positionScreen),G.copy(me.positionScreen),a(I,G)===!0&&(I.multiplyScalar(1/I.w),G.multiplyScalar(1/G.w),h=n(),h.id=w.id,h.v1.positionScreen.copy(I),h.v2.positionScreen.copy(G),h.z=Math.max(I.z,G.z),h.material=w.material,w.material.vertexColors===THREE.VertexColors&&(h.vertexColors[0].copy(w.geometry.colors[_]),h.vertexColors[1].copy(w.geometry.colors[_-1])),V.elements.push(h)))}}else w instanceof THREE.Sprite&&(L.set(x.elements[12],x.elements[13],x.elements[14],1),L.applyMatrix4(k),Se=1/L.w,L.z*=Se,L.z<-1||L.z>1||(u=o(),u.id=w.id,u.x=L.x*Se,u.y=L.y*Se,u.z=L.z,u.object=w,u.rotation=w.rotation,u.scale.x=w.scale.x*Math.abs(u.x-(L.x+R.projectionMatrix.elements[0])/(L.w+R.projectionMatrix.elements[12])),u.scale.y=w.scale.y*Math.abs(u.y-(L.y+R.projectionMatrix.elements[5])/(L.w+R.projectionMatrix.elements[13])),u.material=w.material,V.elements.push(u)))
        return v===!0&&V.elements.sort(r),V}},THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial
    return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){function t(){var e,t,i,n
    for(we.setRGB(0,0,0),Me.setRGB(0,0,0),be.setRGB(0,0,0),e=0,t=w.length;t>e;e++)i=w[e],n=i.color,i instanceof THREE.AmbientLight?we.add(n):i instanceof THREE.DirectionalLight?Me.add(n):i instanceof THREE.PointLight&&be.add(n)}function i(e,t,i){var n,o,r,a,s
    for(n=0,o=w.length;o>n;n++)if(r=w[n],he.copy(r.color),r instanceof THREE.DirectionalLight){if(a=Ce.setFromMatrixPosition(r.matrixWorld).normalize(),s=t.dot(a),0>=s)continue
        s*=r.intensity,i.add(he.multiplyScalar(s))}else if(r instanceof THREE.PointLight){if(a=Ce.setFromMatrixPosition(r.matrixWorld),s=t.dot(Ce.subVectors(a,e).normalize()),0>=s)continue
        if(s*=0==r.distance?1:1-Math.min(e.distanceTo(a)/r.distance,1),0==s)continue
        s*=r.intensity,i.add(he.multiplyScalar(s))}}function n(e,t,i){var n,o,r,a,s,l,E,f,u,d,x,T
    h(i.opacity),m(i.blending),n=t.scale.x*V,o=t.scale.y*j,r=.5*Math.sqrt(n*n+o*o),Se.min.set(e.x-r,e.y-r),Se.max.set(e.x+r,e.y+r),i instanceof THREE.SpriteMaterial?(a=i.map,null!==a&&void 0!==a.image?(a.hasEventListener("update",c)===!1&&(a.image.width>0&&p(a),a.addEventListener("update",c)),s=me[a.id],y(void 0!==s?s:"rgba( 0, 0, 0, 1 )"),l=a.image,E=l.width*a.offset.x,f=l.height*a.offset.y,u=l.width*a.repeat.x,d=l.height*a.repeat.y,x=n/u,T=o/d,k.save(),k.translate(e.x,e.y),0!==i.rotation&&k.rotate(i.rotation),k.translate(-n/2,-o/2),k.scale(x,T),k.translate(-E,-f),k.fillRect(E,f,u,d),k.restore()):(y(i.color.getStyle()),k.save(),k.translate(e.x,e.y),0!==i.rotation&&k.rotate(i.rotation),k.scale(n,-o),k.fillRect(-.5,-.5,1,1),k.restore())):i instanceof THREE.SpriteCanvasMaterial&&(R(i.color.getStyle()),y(i.color.getStyle()),k.save(),k.translate(e.x,e.y),0!==i.rotation&&k.rotate(i.rotation),k.scale(n,o),i.program(k),k.restore())}function o(e,t,i,n){var o,r,a
    if(h(n.opacity),m(n.blending),k.beginPath(),k.moveTo(e.positionScreen.x,e.positionScreen.y),k.lineTo(t.positionScreen.x,t.positionScreen.y),n instanceof THREE.LineBasicMaterial){if(u(n.linewidth),d(n.linecap),x(n.linejoin),n.vertexColors!==THREE.VertexColors)R(n.color.getStyle())
    else if(o=i.vertexColors[0].getStyle(),r=i.vertexColors[1].getStyle(),o===r)R(o)
    else{try{a=k.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y),a.addColorStop(0,o),a.addColorStop(1,r)}catch(s){a=o}R(a)}k.stroke(),Se.expandByScalar(2*n.linewidth)}else n instanceof THREE.LineDashedMaterial&&(u(n.linewidth),d(n.linecap),x(n.linejoin),R(n.color.getStyle()),T([n.dashSize,n.gapSize]),k.stroke(),Se.expandByScalar(2*n.linewidth),T([]))}function r(e,t,n,o,r,c,p,f){if(H.info.render.vertices+=3,H.info.render.faces++,h(f.opacity),m(f.blending),ee=e.positionScreen.x,te=e.positionScreen.y,ie=t.positionScreen.x,ne=t.positionScreen.y,oe=n.positionScreen.x,re=n.positionScreen.y,a(ee,te,ie,ne,oe,re),(f instanceof THREE.MeshLambertMaterial||f instanceof THREE.MeshPhongMaterial)&&null===f.map)Ee.copy(f.color),fe.copy(f.emissive),f.vertexColors===THREE.FaceColors&&Ee.multiply(p.color),ae.copy(we),ze.copy(e.positionWorld).add(t.positionWorld).add(n.positionWorld).divideScalar(3),i(ze,p.normalModel,ae),ae.multiply(Ee).add(fe),f.wireframe===!0?s(ae,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):l(ae)
else if(f instanceof THREE.MeshBasicMaterial||f instanceof THREE.MeshLambertMaterial||f instanceof THREE.MeshPhongMaterial)if(null!==f.map){var u=f.map.mapping
    u===THREE.UVMapping&&(ue=p.uvs,E(ee,te,ie,ne,oe,re,ue[o].x,ue[o].y,ue[r].x,ue[r].y,ue[c].x,ue[c].y,f.map))}else null!==f.envMap?f.envMap.mapping===THREE.SphericalReflectionMapping&&(Ve.copy(p.vertexNormalsModel[o]).applyMatrix3(je),de=.5*Ve.x+.5,xe=.5*Ve.y+.5,Ve.copy(p.vertexNormalsModel[r]).applyMatrix3(je),Re=.5*Ve.x+.5,ye=.5*Ve.y+.5,Ve.copy(p.vertexNormalsModel[c]).applyMatrix3(je),Te=.5*Ve.x+.5,ve=.5*Ve.y+.5,E(ee,te,ie,ne,oe,re,de,xe,Re,ye,Te,ve,f.envMap)):(ae.copy(f.color),f.vertexColors===THREE.FaceColors&&ae.multiply(p.color),f.wireframe===!0?s(ae,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):l(ae))
else f instanceof THREE.MeshDepthMaterial?(ae.r=ae.g=ae.b=1-v(e.positionScreen.z*e.positionScreen.w,Q.near,Q.far),f.wireframe===!0?s(ae,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):l(ae)):f instanceof THREE.MeshNormalMaterial?(Ve.copy(p.normalModel).applyMatrix3(je),ae.setRGB(Ve.x,Ve.y,Ve.z).multiplyScalar(.5).addScalar(.5),f.wireframe===!0?s(ae,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):l(ae)):(ae.setRGB(1,1,1),f.wireframe===!0?s(ae,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):l(ae))}function a(e,t,i,n,o,r){k.beginPath(),k.moveTo(e,t),k.lineTo(i,n),k.lineTo(o,r),k.closePath()}function s(e,t,i,n){u(t),d(i),x(n),R(e.getStyle()),k.stroke(),Se.expandByScalar(2*t)}function l(e){y(e.getStyle()),k.fill()}function c(e){p(e.target)}function p(e){var t,i,n,o,r
    e instanceof THREE.CompressedTexture||(t=e.wrapS===THREE.RepeatWrapping,i=e.wrapT===THREE.RepeatWrapping,n=e.image,o=document.createElement("canvas"),o.width=n.width,o.height=n.height,r=o.getContext("2d"),r.setTransform(1,0,0,-1,0,n.height),r.drawImage(n,0,0),me[e.id]=k.createPattern(o,t===!0&&i===!0?"repeat":t===!0&&i===!1?"repeat-x":t===!1&&i===!0?"repeat-y":"no-repeat"))}function E(e,t,i,n,o,r,a,s,l,E,f,h,m){var u,d,x,R,T,v,H,g,S,w,M,b,C
    if(!(m instanceof THREE.DataTexture)){if(m.hasEventListener("update",c)===!1&&(void 0!==m.image&&m.image.width>0&&p(m),m.addEventListener("update",c)),u=me[m.id],void 0===u)return y("rgba(0,0,0,1)"),void k.fill()
        y(u),w=m.offset.x/m.repeat.x,M=m.offset.y/m.repeat.y,b=m.image.width*m.repeat.x,C=m.image.height*m.repeat.y,a=(a+w)*b,s=(s+M)*C,l=(l+w)*b,E=(E+M)*C,f=(f+w)*b,h=(h+M)*C,i-=e,n-=t,o-=e,r-=t,l-=a,E-=s,f-=a,h-=s,g=l*h-f*E,0!==g&&(S=1/g,d=(h*i-E*o)*S,x=(h*n-E*r)*S,R=(l*o-f*i)*S,T=(l*r-f*n)*S,v=e-d*a-R*s,H=t-x*a-T*s,k.save(),k.transform(d,x,R,T,v,H),k.fill(),k.restore())}}function f(e,t,i){var n,o=t.x-e.x,r=t.y-e.y,a=o*o+r*r
    0!==a&&(n=i/Math.sqrt(a),o*=n,r*=n,t.x+=o,t.y+=r,e.x-=o,e.y-=r)}function h(e){O!==e&&(k.globalAlpha=e,O=e)}function m(e){I!==e&&(e===THREE.NormalBlending?k.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?k.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending&&(k.globalCompositeOperation="darker"),I=e)}function u(e){U!==e&&(k.lineWidth=e,U=e)}function d(e){q!==e&&(k.lineCap=e,q=e)}function x(e){J!==e&&(k.lineJoin=e,J=e)}function R(e){G!==e&&(k.strokeStyle=e,G=e)}function y(e){A!==e&&(k.fillStyle=e,A=e)}function T(e){K.length!==e.length&&(k.setLineDash(e),K=e)}var v,H,g,S,w,M,b,C,z,V,j,L,B,P,W,N,k,F,D,O,I,G,A,U,q,J,K,Q,X,Y,Z,$,_,ee,te,ie,ne,oe,re,ae,se,le,ce,pe,Ee,fe,he,me,ue,de,xe,Re,ye,Te,ve,He,ge,Se,we,Me,be,Ce,ze,Ve,je
    console.log("THREE.CanvasRenderer",THREE.REVISION),v=THREE.Math.smoothstep,e=e||{},H=this,M=new THREE.Projector,b=void 0!==e.canvas?e.canvas:document.createElement("canvas"),C=b.width,z=b.height,V=Math.floor(C/2),j=Math.floor(z/2),L=0,B=0,P=C,W=z,N=1,k=b.getContext("2d",{alpha:e.alpha===!0}),F=new THREE.Color(0),D=e.alpha===!0?0:1,O=1,I=0,G=null,A=null,U=null,q=null,J=null,K=[],$=new THREE.RenderableVertex,_=new THREE.RenderableVertex,ae=new THREE.Color,se=new THREE.Color,le=new THREE.Color,ce=new THREE.Color,pe=new THREE.Color,Ee=new THREE.Color,fe=new THREE.Color,he=new THREE.Color,me={},He=new THREE.Box2,ge=new THREE.Box2,Se=new THREE.Box2,we=new THREE.Color,Me=new THREE.Color,be=new THREE.Color,Ce=new THREE.Vector3,ze=new THREE.Vector3,Ve=new THREE.Vector3,je=new THREE.Matrix3,void 0===k.setLineDash&&(k.setLineDash=function(){}),this.domElement=b,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getPixelRatio=function(){return N},this.setPixelRatio=function(e){N=e},this.setSize=function(e,t,i){C=e*N,z=t*N,b.width=C,b.height=z,V=Math.floor(C/2),j=Math.floor(z/2),i!==!1&&(b.style.width=e+"px",b.style.height=t+"px"),He.min.set(-V,-j),He.max.set(V,j),ge.min.set(-V,-j),ge.max.set(V,j),O=1,I=0,G=null,A=null,U=null,q=null,J=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,i,n){L=e*N,B=t*N,P=i*N,W=n*N},this.setScissor=function(){},this.enableScissorTest=function(){},this.setClearColor=function(e,t){F.set(e),D=void 0!==t?t:1,ge.min.set(-V,-j),ge.max.set(V,j)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return F},this.getClearAlpha=function(){return D},this.getMaxAnisotropy=function(){return 0},this.clear=function(){ge.empty()===!1&&(ge.intersect(He),ge.expandByScalar(2),ge.min.x=ge.min.x+V,ge.min.y=-ge.min.y+j,ge.max.x=ge.max.x+V,ge.max.y=-ge.max.y+j,1>D&&k.clearRect(0|ge.min.x,0|ge.max.y,ge.max.x-ge.min.x|0,ge.min.y-ge.max.y|0),D>0&&(m(THREE.NormalBlending),h(1),y("rgba("+Math.floor(255*F.r)+","+Math.floor(255*F.g)+","+Math.floor(255*F.b)+","+D+")"),k.fillRect(0|ge.min.x,0|ge.max.y,ge.max.x-ge.min.x|0,ge.min.y-ge.max.y|0)),ge.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,i){var a,s,l,c
        if(i instanceof THREE.Camera==!1)return void console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.")
        for(this.autoClear===!0&&this.clear(),H.info.render.vertices=0,H.info.render.faces=0,k.setTransform(P/C,0,0,-W/z,L,z-B),k.translate(V,j),g=M.projectScene(e,i,this.sortObjects,this.sortElements),S=g.elements,w=g.lights,Q=i,je.getNormalMatrix(i.matrixWorldInverse),t(),a=0,s=S.length;s>a;a++)if(l=S[a],c=l.material,void 0!==c&&0!==c.opacity){if(Se.makeEmpty(),l instanceof THREE.RenderableSprite)X=l,X.x*=V,X.y*=j,n(X,l,c)
        else if(l instanceof THREE.RenderableLine)X=l.v1,Y=l.v2,X.positionScreen.x*=V,X.positionScreen.y*=j,Y.positionScreen.x*=V,Y.positionScreen.y*=j,Se.setFromPoints([X.positionScreen,Y.positionScreen]),He.isIntersectionBox(Se)===!0&&o(X,Y,l,c)
        else if(l instanceof THREE.RenderableFace){if(X=l.v1,Y=l.v2,Z=l.v3,X.positionScreen.z<-1||X.positionScreen.z>1)continue
            if(Y.positionScreen.z<-1||Y.positionScreen.z>1)continue
            if(Z.positionScreen.z<-1||Z.positionScreen.z>1)continue
            X.positionScreen.x*=V,X.positionScreen.y*=j,Y.positionScreen.x*=V,Y.positionScreen.y*=j,Z.positionScreen.x*=V,Z.positionScreen.y*=j,c.overdraw>0&&(f(X.positionScreen,Y.positionScreen,c.overdraw),f(Y.positionScreen,Z.positionScreen,c.overdraw),f(Z.positionScreen,X.positionScreen,c.overdraw)),Se.setFromPoints([X.positionScreen,Y.positionScreen,Z.positionScreen]),He.isIntersectionBox(Se)===!0&&r(X,Y,Z,0,1,2,l,c)}ge.union(Se)}k.setTransform(1,0,0,1,0,0)}}
